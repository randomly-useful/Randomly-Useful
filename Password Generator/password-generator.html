<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Password Generator</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 600px; 
      margin: auto; 
      padding: 20px; 
      background: #f5f5f5; 
    }
    h1 { text-align: center; }
    .password-box { display: flex; align-items: center; margin-bottom: 10px; }
    .password-display { 
      flex: 1; 
      font-size: 18px; 
      padding: 10px; 
      border: 1px solid #ccc; 
      border-radius: 6px; 
      background: #fff;
    }
    button { 
      margin-left: 10px; 
      padding: 8px 12px; 
      cursor: pointer; 
      border: none; 
      border-radius: 6px; 
      background: #4CAF50; 
      color: white; 
      transition: background 0.3s; 
    }
    button:hover { background: #45a049; }
    .options { margin: 15px 0; padding: 10px; background: #fff; border-radius: 8px; }
    .strength { height: 10px; border-radius: 5px; margin-top: 10px; background: #eee; }
    .strength-bar { height: 100%; width: 0%; border-radius: 5px; }
    label { display: block; margin: 5px 0; }
  </style>
</head>
<body>

  <h1>üîê Password Generator</h1>

  <!-- Password Display -->
  <div class="password-box">
    <input type="text" id="password" class="password-display" readonly>
    <button onclick="copyPassword()">üìã Copy</button>
  </div>

  <!-- Strength Meter -->
  <div class="strength"><div id="strength-bar" class="strength-bar"></div></div>

  <!-- Options -->
  <div class="options">
    <label>Password Length: 
      <input type="number" id="length" value="16" min="8" max="64">
    </label>
    <label><input type="checkbox" id="uppercase" checked> Uppercase (A‚ÄìZ)</label>
    <label><input type="checkbox" id="lowercase" checked> Lowercase (a‚Äìz)</label>
    <label><input type="checkbox" id="numbers" checked> Numbers (0‚Äì9)</label>
    <label><input type="checkbox" id="symbols" checked> Symbols (!@#$%^&*)</label>
    <label><input type="radio" name="mode" value="random" checked onclick="togglePassphraseOptions(false)"> Random Characters</label>
    <label><input type="radio" name="mode" value="passphrase" onclick="togglePassphraseOptions(true)"> Passphrase Mode (EFF Diceware)</label>

    <!-- Passphrase Options -->
    <div id="passphrase-options" style="display: none; margin-top: 10px;">
      <label>Number of Words:
        <input type="number" id="numWords" value="4" min="3" max="12">
      </label>
    </div>
  </div>

  <!-- Generate Button -->
  <button onclick="generatePassword()">Generate Password</button>

  <!-- Strength library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>

  <script>
    let dicewareList = [];

    // Load Diceware wordlist from external JSON
    fetch("eff-diceware.json")
      .then(res => res.json())
      .then(data => {
        dicewareList = data;
        console.log("Diceware wordlist loaded:", dicewareList.length, "words");
      });

    function togglePassphraseOptions(show) {
      document.getElementById("passphrase-options").style.display = show ? "block" : "none";
    }

    function generatePassword() {
      const length = parseInt(document.getElementById("length").value, 10);
      const uppercase = document.getElementById("uppercase").checked;
      const lowercase = document.getElementById("lowercase").checked;
      const numbers = document.getElementById("numbers").checked;
      const symbols = document.getElementById("symbols").checked;
      const mode = document.querySelector("input[name='mode']:checked").value;

      let password = "";
      if (mode === "random") {
        password = generateRandomPassword(length, uppercase, lowercase, numbers, symbols);
      } else {
        const numWords = parseInt(document.getElementById("numWords").value, 10) || 4;
        password = generatePassphrase(numWords);
      }

      document.getElementById("password").value = password;

      // Strength check
      const strength = zxcvbn(password);
      const strengthBar = document.getElementById("strength-bar");
      strengthBar.style.width = (strength.score + 1) * 20 + "%";
      strengthBar.style.background = ["red", "orange", "yellow", "blue", "green"][strength.score];
    }

    function copyPassword() {
      const passwordField = document.getElementById("password");
      passwordField.select();
      document.execCommand("copy");
      alert("Password copied to clipboard!");
    }

    function generateRandomPassword(length, uppercase, lowercase, numbers, symbols) {
      let charset = "";
      if (uppercase) charset += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      if (lowercase) charset += "abcdefghijklmnopqrstuvwxyz";
      if (numbers) charset += "0123456789";
      if (symbols) charset += "!@#$%^&*()-_=+[]{};:,.<>?";
      if (!charset) return "";

      let password = "";
      const array = new Uint32Array(length);
      window.crypto.getRandomValues(array);
      for (let i = 0; i < length; i++) {
        password += charset[array[i] % charset.length];
      }
      return password;
    }

    function generatePassphrase(numWords = 4) {
      if (dicewareList.length === 0) return "Loading wordlist...";
      
      let words = [];
      for (let i = 0; i < numWords; i++) {
        const rand = new Uint32Array(1);
        crypto.getRandomValues(rand);
        const randomIndex = rand[0] % dicewareList.length;
        words.push(dicewareList[randomIndex]);
      }
      return words.join("-");
    }
  </script>

</body>
</html>
